<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Prototype Génération de Mélodie</title>
  <link rel="stylesheet" href="styles.css?v=36">
  <link rel="icon" href="favicon.svg" type="image/svg+xml">
</head>
<body>
  <p class="site-version">Version du site&nbsp;: v36</p>
  <header class="hero">
    <div>
      <p class="eyebrow">Prototype</p>
      <h1>Générateur de mélodie</h1>
      <p class="lead">
        Configurez les paramètres, générez une mélodie contrainte par les règles A/B/C/E, puis écoutez la séquence avec l’instrument sélectionné.
      </p>
    </div>
  </header>

  <main>
    <section class="panel">
      <h2>Paramètres</h2>
      <div class="form-grid">
        <label class="field" for="primary-tones">
          <span>Primary tones (A)</span>
          <textarea id="primary-tones" rows="2" placeholder="Ex: c#, e, g">e, g, b</textarea>
        </label>

        <label class="field" for="secondary-tones">
          <span>Secondary tones (B)</span>
          <textarea id="secondary-tones" rows="2" placeholder="Ex: d, f#, a">f#, a, c, d</textarea>
        </label>

        <label class="field" for="forbidden-tones">
          <span>Forbidden tones (C)</span>
          <textarea id="forbidden-tones" rows="2" placeholder="Ex: db, gb, bb">g#, c#</textarea>
        </label>

        <label class="field" for="ambitus-min">
          <span>Ambitus min (MIDI)</span>
          <input id="ambitus-min" type="number" min="0" max="127" step="1" value="50">
        </label>

        <label class="field" for="ambitus-max">
          <span>Ambitus max (MIDI)</span>
          <input id="ambitus-max" type="number" min="0" max="127" step="1" value="72">
        </label>

        <label class="field" for="instrument-select">
          <span>Instrument</span>
          <select id="instrument-select"></select>
        </label>
      </div>

      <h3>Probabilités rythmiques</h3>
      <label class="slider-row bpm-row" for="bpm-slider">
        <span class="slider-label">BPM</span>
        <div class="slider-input-wrap">
          <input id="bpm-slider" type="range" min="30" max="140" step="1" value="92">
          <span class="slider-value" id="bpm-value">92</span>
        </div>
      </label>
      <label class="slider-row" for="repetition-penalty-slider">
        <span class="slider-label">Pénalité notes répétées</span>
        <div class="slider-input-wrap">
          <input id="repetition-penalty-slider" type="range" min="0" max="1" step="0.01" value="0.25">
          <span class="slider-value" id="repetition-penalty-value">0.25</span>
        </div>
      </label>
      <div class="rhythm-grid" id="jump-sliders"></div>

      <h3>Triolets</h3>
      <div class="slider-group" id="triplet-sliders"></div>

      <h3>Génération note suivante après triolet</h3>
      <div class="slider-group" id="after-triplet-sliders"></div>

      <div class="preset-row">
        <input id="preset-name" type="text" placeholder="Nom du preset rythmique">
        <button id="save-preset-btn" type="button">Sauvegarder preset</button>
        <select id="preset-select"></select>
        <button id="load-preset-btn" type="button">Charger</button>
        <button id="delete-preset-btn" type="button">Effacer</button>
      </div>

      <div class="preset-transfer-row">
        <button id="export-preset-values-btn" type="button">Exporter probas (.json)</button>
        <button id="import-preset-values-btn" type="button">Importer probas</button>
        <input id="import-preset-values-file" type="file" accept="application/json" hidden>
      </div>

      <h3>Règles d’ornements (par note)</h3>
      <div class="ornament-rules" id="ornament-rules">
        <label><input id="rule-long-note-e" type="checkbox"> Long → note E</label>
        <label><input id="rule-long-note-b" type="checkbox"> Long → note B</label>
        <label><input id="rule-long-last-preset-melodique" type="checkbox"> Long → toutes les notes si dernier preset chargé = «&nbsp;Mélodique&nbsp;»</label>
        <label><input id="rule-fall-last-note" type="checkbox"> Fall → dernière note (démarre à mi-note)</label>
        <label><input id="rule-fall-interval-3" type="checkbox"> Fall → note de catégorie A, pas « long », et distante d’au moins 3 double-croches avec la suivante</label>
        <label><input id="rule-bend-first-if-3" type="checkbox"> Bend → première note si sa longueur est d’au moins 3 double-croches</label>
        <label><input id="rule-vibrato-longest" type="checkbox"> Vibrato → note la plus longue de la série (uniquement si « long » et sans bend)</label>
        <label><input id="rule-portamento-before-largest-interval" type="checkbox"> Portamento → note avant le plus grand intervalle (si elle tient jusqu’à la suivante)</label>
      </div>

      <div class="controls">
        <button class="primary" id="generate-btn" type="button">Générer</button>
        <button id="replay-btn" type="button" disabled>Replay</button>
      </div>

      <p id="status" class="status">Prêt.</p>
    </section>

    <section class="panel">
      <h2>Résultat</h2>
      <p><strong>Instrument:</strong> <span id="result-instrument">—</span></p>
      <p><strong>Pattern (4 temps):</strong> <span id="result-pattern">—</span></p>
      <p><strong>Série:</strong> <span id="result-sequence">—</span></p>
    </section>
  </main>

  <footer>
    <p>Version prototype v36: règles d’ornements activables par condition note-à-note.</p>
  </footer>

  <script src="https://unpkg.com/tone@14.7.77/build/Tone.js?v=36"></script>
  <script type="module" src="main.js?v=36"></script>
</body>
</html>
